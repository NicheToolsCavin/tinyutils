name: DLF Quick Extras

on:
  pull_request:
    branches: [ main ]
  workflow_dispatch: {}

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node 20 (for parity)
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
      - name: Ensure jq
        run: |
          if ! command -v jq >/dev/null 2>&1; then
            sudo apt-get update
            sudo apt-get install -y jq
          fi
      - name: API smokes (extras)
        env:
          TINYUTILS_BASE: ${{ inputs.preview_url || secrets.TINYUTILS_BASE || 'https://tinyutils-eight.vercel.app' }}
          VERCEL_AUTOMATION_BYPASS_SECRET: ${{ secrets.VERCEL_AUTOMATION_BYPASS_SECRET }}
          PREVIEW_SECRET: ${{ secrets.PREVIEW_SECRET }}
          DLF_SMOKE_ARTIFACTS: tinyutils/artifacts/dlf_extras/github-${{ github.run_id }}
        run: bash scripts/smoke_dlf_extras.sh
