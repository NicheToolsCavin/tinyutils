<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Text File Converter ‚Äî TinyUtils</title>
  <meta name="description" content="Convert text files between formats. Supports Markdown, plain text, and HTML.">
  <link rel="canonical" href="https://tinyutils-eight.vercel.app/tools/text-converter/">
  <link rel="icon" href="/public/favicon.ico">
  <meta property="og:title" content="Text File Converter ‚Äî TinyUtils">
  <meta property="og:description" content="Convert text files between formats. Supports Markdown, plain text, and HTML.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/public/og.png">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="stylesheet" href="/public/styles.css">
  <link rel="stylesheet" href="/styles/site.css">
  <script defer src="/scripts/consent.js"></script>
  <style>
    main { padding-bottom: 48px; }
    .tool-intro h1 { margin-bottom: 0.25rem; }
    .tool-intro p { margin-top: 0; color: var(--muted, #97a3c2); }
    .card { margin-top: 1rem; }
    .mode-primary { margin-top: 1rem; display: flex; flex-direction: column; gap: 0.5rem; }
    .mode-primary input { width: 100%; max-width: 100%; }
    .options-grid { display: grid; gap: 0.75rem; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-top: 1rem; }
    .actions-row { display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center; margin-top: 1rem; }
    .actions-row button.primary { background: var(--brand, #3b82f6); color: #fff; border: none; padding: 0.65rem 1.4rem; border-radius: 0.75rem; cursor: pointer; }
    .actions-row button.primary[disabled] { opacity: 0.6; cursor: not-allowed; }
    .actions-row button.secondary { background: transparent; color: inherit; border: 1px solid rgba(255,255,255,0.2); border-radius: 0.75rem; padding: 0.55rem 1.25rem; cursor: pointer; }
    .advanced details { margin-top: 1rem; }
    .advanced-inputs { display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1rem; }
    .advanced-grid { display: grid; gap: 0.5rem; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-top: 0.75rem; }
    label span.help { color: var(--muted, #97a3c2); font-size: 0.8rem; display: block; margin-top: 0.2rem; }
    textarea { min-height: 160px; }
    #progress { min-height: 1.5rem; display: flex; align-items: center; gap: 0.5rem; }
    .status-bar { display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap; }
    .filter-group { display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap; }
    .export-group { display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center; }
    .export-group button { border-radius: 0.6rem; padding: 0.5rem 1rem; border: 1px solid rgba(255,255,255,0.18); background: transparent; color: inherit; cursor: pointer; }
    .export-group button:disabled { opacity: 0.4; cursor: not-allowed; }
    .meta-info { display: flex; flex-direction: column; gap: 0.25rem; min-width: 200px; }
    .meta-line { color: var(--muted, #97a3c2); font-size: 0.85rem; word-break: break-word; }
    .meta-line-row { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
    .debug-panel { margin-top: 1rem; border: 1px solid rgba(255,255,255,0.15); border-radius: 0.75rem; padding: 0.5rem 0.75rem; background: rgba(11,18,36,0.35); }
    .debug-panel summary { cursor: pointer; font-weight: 600; }
    .debug-content { display: grid; gap: 0.75rem; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-top: 0.5rem; }
    .debug-list { margin: 0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 0.85rem; }
    .debug-list dt { font-weight: 600; }
    .debug-list dd { margin: 0 0 0.5rem 0; word-break: break-all; }
    .debug-meta { margin: 0; padding: 0.5rem; background: rgba(12,19,32,0.5); border-radius: 0.5rem; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 0.85rem; max-height: 240px; overflow: auto; }
    .debug-scheduler { margin: 0 0 0.5rem 0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 0.85rem; }
    .toast { position: fixed; right: 16px; bottom: 16px; background: #0b1224; color: #e6edf7; border: 1px solid rgba(255,255,255,0.12); padding: 10px 14px; border-radius: 10px; z-index: 9999; box-shadow: 0 12px 30px rgba(0,0,0,0.35); }
    .tableWrap { margin-top: 1rem; max-height: 70vh; overflow: auto; border: 1px solid #eee; border-radius: 8px; }
    #results thead th { position: sticky; top: 0; z-index: 2; background: #fff; box-shadow: 0 1px 0 rgba(0,0,0,0.05); }
    td .url-text { word-break: break-all; display: inline-block; max-width: 420px; }
    .cell-url { word-break: break-all; }
    .visually-hidden { position: absolute !important; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container row between center">
      <a class="brand" href="/">TinyUtils</a>
      <nav class="nav">
        <a class="active" href="/tools/">Tools</a>
        <a href="/privacy.html">Privacy</a>
        <a href="/terms.html">Terms</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="container tool-intro">
      <h1>üìù Text File Converter</h1>
      <p>Convert files between Markdown, plain text, and HTML. Paste content or upload a file to get started.</p>
      <p><a class="cta" href="/tools/">See all tools ‚Üí</a></p>

      <section class="card" role="region" aria-labelledby="inputHeading">
        <h2 id="inputHeading">Input</h2>
        <div class="mode-primary">
          <label for="textInput">Paste text
            <span class="help">Paste the content of your file here.</span>
          </label>
          <textarea id="textInput" rows="10" placeholder="Paste your Markdown, text, or HTML here..."></textarea>
        </div>
        <div class="mode-primary" style="margin-top: 1rem;">
          <label for="fileInput">Or upload a file
            <span class="help">Supported formats: .md, .txt, .html</span>
          </label>
          <input type="file" id="fileInput" accept=".md,.txt,.html,text/plain,text/markdown">
        </div>

        <div class="options-grid" aria-label="Options" style="margin-top: 1.5rem;">
          <fieldset>
            <legend>Output formats</legend>
            <div class="formats-group" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem;">
              <label for="formatMd"><input type="checkbox" id="formatMd" value="md" checked> Markdown</label>
              <label for="formatTxt"><input type="checkbox" id="formatTxt" value="txt" checked> Plain Text</label>
              <label for="formatHtml"><input type="checkbox" id="formatHtml" value="html" checked> HTML</label>
            </div>
          </fieldset>
        </div>

        <div class="actions-row">
          <button id="runBtn" class="primary" type="button">Convert</button>
          <button id="clearBtn" class="secondary" type="button">Clear</button>
          <span class="badge">Shortcut: <kbd>Ctrl/Cmd + Enter</kbd> to convert</span>
        </div>
        <div id="progress" aria-live="polite"></div>
      </section>

      <section class="card" role="region" aria-labelledby="resultsHeading">
        <h2 id="resultsHeading">Results</h2>
        <div id="results-container" class="tableWrap" style="margin-top: 1rem;">
          <p id="results-placeholder">Converted files will appear here as download links.</p>
        </div>
      </section>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container row between wrap">
      <span>¬© <span id="year"></span> TinyUtils</span>
      <span><a href="/privacy.html">Privacy</a> ¬∑ <a href="/terms.html">Terms</a></span>
    </div>
  </footer>

    <script>
      const textInputEl = document.getElementById('textInput');
      const fileInputEl = document.getElementById('fileInput');
      const formatMdEl = document.getElementById('formatMd');
      const formatTxtEl = document.getElementById('formatTxt');
      const formatHtmlEl = document.getElementById('formatHtml');
      const runBtn = document.getElementById('runBtn');
      const clearBtn = document.getElementById('clearBtn');
      const progressEl = document.getElementById('progress');
      const resultsContainer = document.getElementById('results-container');
      const resultsPlaceholder = document.getElementById('results-placeholder');
  
      document.getElementById('year').textContent = new Date().getFullYear();
  
      function showToast(message) {
        const existing = document.querySelector('.toast');
        if (existing) existing.remove();
        const div = document.createElement('div');
        div.className = 'toast';
        div.textContent = message;
        document.body.appendChild(div);
        setTimeout(() => { div.remove(); }, 4000);
      }
  
      function getSelectedFormats() {
        const formats = [];
        if (formatMdEl.checked) formats.push(formatMdEl.value);
        if (formatTxtEl.checked) formats.push(formatTxtEl.value);
        if (formatHtmlEl.checked) formats.push(formatHtmlEl.value);
        return formats;
      }
  
      function renderResults(outputs) {
        resultsPlaceholder.style.display = 'none';
        resultsContainer.innerHTML = ''; // Clear previous results
  
        const table = document.createElement('table');
        table.id = 'results';
        const thead = document.createElement('thead');
        thead.innerHTML = `
          <tr>
            <th scope="col">Filename</th>
            <th scope="col">Format</th>
            <th scope="col">Download</th>
          </tr>
        `;
        table.appendChild(thead);
  
        const tbody = document.createElement('tbody');
        outputs.forEach(output => {
          const tr = document.createElement('tr');
          const downloadLink = `<a href="${output.blobUrl}" download="${output.name}">Download</a>`;
          tr.innerHTML = `
            <td>${output.name}</td>
            <td>${output.format}</td>
            <td>${downloadLink}</td>
          `;
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        resultsContainer.appendChild(table);
      }
  
      async function buildPayload() {
        const textContent = textInputEl.value.trim();
        const file = fileInputEl.files[0];
  
        if (!textContent && !file) {
          throw new Error('Please paste text or upload a file.');
        }
  
        let blobUrl;
        let name;
        let from = 'text';
  
        if (file) {
          name = file.name;
          const reader = new FileReader();
          blobUrl = await new Promise((resolve, reject) => {
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
          if (name.endsWith('.md')) {
            from = 'markdown';
          } else if (name.endsWith('.html')) {
            from = 'html';
          }
        } else {
          name = 'pasted-content.txt';
          const base64 = btoa(textContent);
          blobUrl = `data:text/plain;base64,${base64}`;
        }
  
        const to = getSelectedFormats();
        if (to.length === 0) {
          throw new Error('Please select at least one output format.');
        }
  
        return {
          inputs: [{ blobUrl, name }],
          from,
          to,
          options: { extractMedia: false }
        };
      }
  
      runBtn?.addEventListener('click', async (event) => {
        event.preventDefault();
        progressEl.textContent = '';
        runBtn.disabled = true;
  
        try {
          const payload = await buildPayload();
          progressEl.textContent = 'Converting‚Ä¶';
          resultsPlaceholder.style.display = 'block';
          resultsContainer.innerHTML = '';
  
          const res = await fetch('/api/convert', {
            method: 'POST',
            headers: { 'content-type': 'application/json' },
            body: JSON.stringify(payload)
          });
  
          const data = await res.json();
  
          if (!res.ok || !data.ok) {
            const errorType = data.errorType || 'unknown_error';
            const errorMessage = data.errorMessage || 'An unknown error occurred.';
            throw new Error(`Conversion failed: ${errorType} - ${errorMessage}`);
          }
  
          renderResults(data.outputs);
          progressEl.textContent = 'Done.';
  
        } catch (err) {
          progressEl.textContent = `Error: ${err.message}`;
        } finally {
          runBtn.disabled = false;
        }
      });
  
      clearBtn?.addEventListener('click', () => {
        textInputEl.value = '';
        fileInputEl.value = '';
        progressEl.textContent = '';
        resultsContainer.innerHTML = '';
        resultsPlaceholder.style.display = 'block';
        resultsContainer.appendChild(resultsPlaceholder);
      });
  
      document.addEventListener('keydown', (e) => {
        const inField = /^(INPUT|TEXTAREA)$/.test(e.target?.nodeName) || e.target?.isContentEditable;
        if (!e.metaKey && !e.ctrlKey) return;
        if (inField && e.target.id === 'textInput') return;
  
        if (e.key.toLowerCase() === 'enter') {
          e.preventDefault();
          runBtn?.click();
        }
      });
    </script>
</body>
</html>
